# Reddit API 限制说明

> 最后更新：2026-02 | 文档索引：`docs/README.md`

## 单次请求限制

### Limit 参数最大值

**Reddit API 的 `limit` 参数最大值为 100**

测试结果：
- `limit=25`: 返回 25 个帖子 ✅
- `limit=50`: 返回 50 个帖子 ✅
- `limit=100`: 返回 100 个帖子 ✅
- `limit=101`: 只返回 100 个帖子（被限制）⚠️
- `limit=200`: 只返回 100 个帖子（被限制）⚠️

### API 端点限制

对于 `/r/{subreddit}/hot.json` 端点：
- **最大 limit**: 100
- 超过 100 的值会被自动限制为 100
- 建议使用 100 作为最大值

## 实际获取文档数量计算

### 当前实现逻辑

在社交平台数据获取功能中：

1. **每个子论坛的 limit**：
   - 代码中：`limit_per_subreddit = limit`（从参数传入）
   - 默认搜索的子论坛：`["Lottery", "lottery", "Powerball", "MegaMillions"]`（4个）
   - 每个子论坛最多：100 个帖子

2. **关键词过滤**：
   - 关键词过滤是在获取帖子后进行的
   - 如果帖子标题或内容不包含关键词，会被过滤掉
   - **实际返回的帖子数可能少于 limit**

3. **去重逻辑**：
   - 检查 URI 是否已存在于数据库
   - 已存在的会被跳过，不计入新增

### 理论最大值

**单次请求最多可获取的文档数**：

- **单个关键词 + 单个子论坛**: 最多 100 个
- **单个关键词 + 4 个子论坛**: 最多 400 个（4 × 100）
- **多个关键词 + 4 个子论坛**: 
  - 每个关键词在每个子论坛最多 100 个
  - 实际数量取决于关键词匹配情况
  - 理论最大值 = 关键词数 × 4 × 100

**示例**：
- 1 个关键词，4 个子论坛：最多 400 个帖子
- 5 个关键词，4 个子论坛：最多 2000 个帖子（理论值）

### 实际限制因素

1. **关键词匹配**：
   - 不是所有帖子都包含关键词
   - 实际匹配的帖子数通常远少于 limit

2. **去重**：
   - 已存在的帖子会被跳过
   - 实际新增数 = 总数 - 已存在数

3. **速率限制**：
   - Reddit API 有速率限制
   - 建议控制请求频率

## 代码中的限制

### API 参数限制

```python
limit: int = Field(default=20, ge=1, le=100, description="每个关键词的结果数量限制")
```

- **最小值**: 1
- **最大值**: 100 ✅
- **默认值**: 20

### 子论坛数量

当前代码中硬编码了 4 个子论坛：
```python
subreddits = ["Lottery", "lottery", "Powerball", "MegaMillions"]
```

## 建议配置

### 推荐设置

1. **单个关键词测试**：
   - `limit=20`（默认值）
   - 预计获取：20-80 个帖子（取决于关键词匹配）

2. **批量获取**：
   - `limit=100`（最大值）
   - 预计获取：100-400 个帖子（取决于关键词匹配和子论坛）

3. **多个关键词**：
   - 每个关键词独立计算
   - 建议关键词数量：3-5 个
   - 总预计：300-2000 个帖子（理论值）

### 性能考虑

1. **请求时间**：
   - 每个子论坛需要 1 次 API 请求
   - 4 个子论坛 = 4 次请求
   - 每次请求约 1-2 秒

2. **LLM 提取**：
   - 如果启用 `enable_extraction=true`
   - 每个帖子需要调用 LLM
   - 会显著增加处理时间

3. **数据库写入**：
   - 批量写入效率较高
   - 建议使用事务批量提交

## 总结

**单次请求最多可获取的文档数**：

- **单个请求（单个子论坛）**: 最多 **100 个**帖子
- **完整流程（4个子论坛）**: 最多 **400 个**帖子（理论值）
- **多个关键词**: 关键词数 × 400（理论值）

**实际获取数量**取决于：
- 关键词匹配情况
- 已存在文档数量
- 子论坛活跃度

**推荐配置**：
- 日常使用：`limit=20-50`
- 批量获取：`limit=100`（最大值）
- 关键词数：3-5 个

