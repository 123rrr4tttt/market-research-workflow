# 日期提取与修复总览

> 最后更新：2026-02 | 文档索引：`docs/README.md`

## 1. 文档定位

本文件为“发布日期提取”主题主文档，汇总实现方案、提取优先级、优化结果和后续建议。

历史过程报告已归档至 `main/backend/docs/archive/date-extraction/`。

## 2. 背景与目标

`publish_date` 缺失会影响：

- 前端列表展示日期
- 趋势统计按时间聚合
- 数据质量与排序可信度

目标是提升发布日期提取覆盖率，并将能力集成到数据摄取/存储流程。

## 3. 实现位置（代码）

- `main/backend/app/services/discovery/store.py`

关键函数（当前能力）：

- `_extract_date_from_url()`
- `_extract_date_from_html()`
- `_extract_date_from_http_headers()`
- `_extract_date_from_text()`
- `_extract_publish_date()`
- `_fetch_content()`
- `store_results()`

## 4. 当前提取策略（优先级）

1. URL / 文件名日期（含 PDF 文件名）
2. HTML Meta / JSON-LD / `time` 标签
3. HTTP 响应头 `Last-Modified`
4. `extracted_data`（含嵌套对象）
5. 文本内容正则（优先上下文字段）
6. 兜底：`created_at`（仅在业务场景允许时）

## 5. 当前支持能力（摘要）

### 5.1 URL / 文件名

- `YYYY-MM-DD` / `YYYYMMDD` / `YYYY_MM_DD`
- `MM-DD-YY` / `MM-DD-YYYY`
- 财政年度格式（如 `FY 2023-24`）

### 5.2 HTML / 结构化数据

- Open Graph：`article:published_time`
- Schema.org：`datePublished`
- Dublin Core：`DC.date`
- JSON-LD（递归检查 `datePublished/dateModified/dateCreated/...`）
- `time` 标签（支持时区格式）

### 5.3 HTTP 响应头

- `Last-Modified`（对 PDF/静态文件较有帮助）

### 5.4 文本内容

- 支持上下文关键词：
  - `Published`
  - `Last updated`
  - `发布日期`
  - `最后更新`
  - `生效日期`
- 支持 ISO / 美式日期 / 英文月份格式

## 6. 效果总结（按历史报告汇总）

不同批次报告口径存在差异，但总体趋势一致：

- 初始阶段提取率较低（个位数到低双位数）
- 增强 HTML/JSON-LD/文本与格式兼容后，提取能力明显提升
- 引入重新抓取与更稳健的日期解析后，样本提取率显著提升（历史报告中有约 `45%` 样本结果）
- 批量修复数量提升（历史报告记录有“修复 20 个文档”的结果）

## 7. 仍然常见的问题

### 7.1 静态页面无明确发布日期

- FAQ/首页/栏目页常无显式发布日期
- 建议在展示和统计场景中允许使用 `created_at` 兜底，但需明确口径

### 7.2 PDF 日期来源不稳定

当前可用：

- 文件名日期
- `Last-Modified`

建议增强：

- 增加 PDF 元数据读取（如 `pypdf`）

### 7.3 来源差异大

- 同一类站点结构化数据字段命名不一致
- 建议为高频来源补充 domain-specific 规则

## 8. 验证与监控建议

建议跟踪：

- 总体提取率
- 分来源提取率
- 分文档类型提取率
- 兜底 `created_at` 占比
- 新摄取文档提取率（按日/周）

## 9. 与统计接口的约定建议

- 趋势统计需明确时间字段口径（`publish_date` 或 `publish_date->created_at` 回退）
- 前端图表应标注统计口径，避免误解

## 10. 历史归档（来源）

位于 `main/backend/docs/archive/date-extraction/`：

- `发布日期提取分析报告.md`
- `剩余文档日期提取分析报告.md`
- `链接分析总结报告.md`
- `修复脚本改进效果对比.md`
- `日期提取功能增强说明.md`
- `日期提取优化总结.md`

